@page "/NoFactory"
@using OOAP1.Models;
@using MudBlazor
@inject ElectronicFactoryImplementation Creator;
@inject ISnackbar _snackbar;
<PageTitle>Магазин электронники с фабрикой.</PageTitle>
<style>
    .mud-table-cell {
        border: 1px solid black;
    }

    table {
        width: 650px;
        border: 1px solid black;
        border-collapse: collapse;
        text-align: center;
        margin-bottom: 20px;
    }

    td {
        text-align: left;
        padding: 10px;
        border: 1px solid black;
    }

    th {
        text-align: center;
        padding: 10px;
        border: 1px solid black;
    }
</style>

<div style="width:20vw">
    <MudSelect T="string" @bind-Value="@Role" Label="Выберете свою роль.">
        @foreach (var item in Roles)
        {
            <MudSelectItem Value="@item" />
        }
    </MudSelect>
</div>

@if (electronics.Count > 0)
{
    <span style="font-size:larger">Полная номенклатура комплектующих.</span>
    <MudTable Height="400px" Items="@electronics">
        <HeaderContent>
            <MudTh>Номер</MudTh>
            <MudTh>Имя</MudTh>
            <MudTh>Цена</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Nr">@context.Number</MudTd>
            <MudTd DataLabel="Sign">@context.Name</MudTd>
            <MudTd DataLabel="Name">@context.Price руб.</MudTd>
        </RowTemplate>
    </MudTable>
}

<div>
    <span style="font-size:larger">Поиск товара по номеру</span>
    <MudItem xs="12" sm="6" md="4">
        <MudAutocomplete Clearable="true" T="ElectronicBase" Label="Введите номер" @bind-Value="test"
                         SearchFunc="@Search" ToStringFunc="@(e=> e==null?null : $"{e.Number} ({e.Name})")" />
    </MudItem>
    <div style="margin-top:30px">
        @if (test != null)
        {
            <span>Подробная информация: </span>
            @if (test.Name.Contains("CPU"))
            {

                <table>
                    <tr>
                        <th>Номер</th>
                        <th>Имя</th>
                        <th>Цена</th>
                        <th>Тип сокета</th>
                        <th>Кол-во ядер</th>
                        <th>Частота</th>
                        <th>Тех. процесс</th>
                    </tr>
                    <tr>
                        <td>
                            @(
                                ((CPU)test).Number
                                )
                        </td>
                        <td>
                            @(
                                ((CPU)test).Name
                                )
                        </td>
                        <td>
                            @(
                                ((CPU)test).Price
                                ) Руб.
                        </td>
                        <td>
                            @(
                                ((CPU)test).SocketType
                                )
                        </td>
                        <td>
                            @(
                                ((CPU)test).NumOfCores
                                )
                        </td>
                        <td>
                            @(
                                ((CPU)test).ClockFrequency
                                )GHz
                        </td>
                        <td>
                            @(
                                ((CPU)test).TechProcc
                                )
                        </td>
                    </tr>
                </table>
            }
            else if (test.Name.Contains("Motherboard"))
            {
                <table>
                    <tr>
                        <th>Номер</th>
                        <th>Имя</th>
                        <th>Цена</th>
                        <th>Тип сокета</th>
                        <th>Кол-во процессоров</th>
                        <th>Тип памяти</th>
                        <th>Частота</th>
                    </tr>
                    <tr>
                        <td>
                            @(
                                ((Motherboard)test).Number
                                )
                        </td>
                        <td>
                            @(
                                ((Motherboard)test).Name
                                )
                        </td>
                        <td>
                            @(
                                ((Motherboard)test).Price
                                ) Руб.
                        </td>
                        <td>
                            @(
                                ((Motherboard)test).SocketType
                                )
                        </td>
                        <td>
                            @(
                                ((Motherboard)test).NumProcc
                                )
                        </td>
                        <td>
                            @(
                                ((Motherboard)test).RamType
                                )
                        </td>
                        <td>
                            @(
                                ((Motherboard)test).Frequency
                                )GHz
                        </td>
                    </tr>
                </table>
            }
            else if (test.Name.Contains("HDD"))
            {
                <table>
                    <tr>
                        <th>Номер</th>
                        <th>Имя</th>
                        <th>Цена</th>
                        <th>Объем</th>
                        <th>Скорость вращения</th>
                        <th>Тип интерфейса</th>

                    </tr>
                    <tr>
                        <td>
                            @(
                                ((HDD)test).Number
                                )
                        </td>
                        <td>
                            @(
                                ((HDD)test).Name
                                )
                        </td>
                        <td>
                            @(
                                ((HDD)test).Price
                                ) Руб.
                        </td>
                        <td>
                            @(
                                ((HDD)test).Capacity
                                )
                        </td>
                        <td>
                            @(
                                ((HDD)test).Speed
                                )
                        </td>
                        <td>
                            @(
                                ((HDD)test).InterfaceType
                                )
                        </td>
                    </tr>
                </table>
            }

        }
    </div>
    <div>
        <MudButton OnClick="MakeOrder" Size="Size.Medium" Color="Color.Primary">Заказать товар</MudButton>
        @if (newElectronic != null)
        {
            <div style="margin: 20px 0 0 0">
                <span>Подробная информация: </span>
                @if (newElectronic.Name.Contains("CPU"))
                {

                    <table>
                        <tr>
                            <th>Номер</th>
                            <th>Имя</th>
                            <th>Цена</th>
                            <th>Тип сокета</th>
                            <th>Кол-во ядер</th>
                            <th>Частота</th>
                            <th>Тех. процесс</th>
                        </tr>
                        <tr>
                            <td>
                                @(
                                    ((CPU)newElectronic).Number
                                    )
                            </td>
                            <td>
                                @(
                                    ((CPU)newElectronic).Name
                                    )
                            </td>
                            <td>
                                @(
                                    ((CPU)newElectronic).Price
                                    ) Руб.
                            </td>
                            <td>
                                @(
                                    ((CPU)newElectronic).SocketType
                                    )
                            </td>
                            <td>
                                @(
                                    ((CPU)newElectronic).NumOfCores
                                    )
                            </td>
                            <td>
                                @(
                                    ((CPU)newElectronic).ClockFrequency
                                    )GHz
                            </td>
                            <td>
                                @(
                                    ((CPU)newElectronic).TechProcc
                                    )
                            </td>
                        </tr>
                    </table>
                }
                else if (newElectronic.Name.Contains("Motherboard"))
                {
                    <table>
                        <tr>
                            <th>Номер</th>
                            <th>Имя</th>
                            <th>Цена</th>
                            <th>Тип сокета</th>
                            <th>Кол-во процессоров</th>
                            <th>Тип памяти</th>
                            <th>Частота</th>
                        </tr>
                        <tr>
                            <td>
                                @(
                                    ((Motherboard)newElectronic).Number
                                    )
                            </td>
                            <td>
                                @(
                                    ((Motherboard)newElectronic).Name
                                    )
                            </td>
                            <td>
                                @(
                                    ((Motherboard)newElectronic).Price
                                    ) Руб.
                            </td>
                            <td>
                                @(
                                    ((Motherboard)newElectronic).SocketType
                                    )
                            </td>
                            <td>
                                @(
                                    ((Motherboard)newElectronic).NumProcc
                                    )
                            </td>
                            <td>
                                @(
                                    ((Motherboard)newElectronic).RamType
                                    )
                            </td>
                            <td>
                                @(
                                    ((Motherboard)newElectronic).Frequency
                                    )GHz
                            </td>
                        </tr>
                    </table>
                }
                else if (newElectronic.Name.Contains("HDD"))
                {
                    <table>
                        <tr>
                            <th>Номер</th>
                            <th>Имя</th>
                            <th>Цена</th>
                            <th>Объем</th>
                            <th>Скорость вращения</th>
                            <th>Тип интерфейса</th>

                        </tr>
                        <tr>
                            <td>
                                @(
                                    ((HDD)newElectronic).Number
                                    )
                            </td>
                            <td>
                                @(
                                    ((HDD)newElectronic).Name
                                    )
                            </td>
                            <td>
                                @(
                                    ((HDD)newElectronic).Price
                                    ) Руб.
                            </td>
                            <td>
                                @(
                                    ((HDD)newElectronic).Capacity
                                    )
                            </td>
                            <td>
                                @(
                                    ((HDD)newElectronic).Speed
                                    )
                            </td>
                            <td>
                                @(
                                    ((HDD)newElectronic).InterfaceType
                                    )
                            </td>
                        </tr>
                    </table>
                }
            </div>
        }

    </div>
</div>

@code {
    public string Role = "";
    public ElectronicBase? newElectronic;
    public List<string> Roles = new() { "Кладовщик", "Покупатель" };
    public List<ElectronicBase> electronics = new();
    ElectronicBase test;
    protected override void OnInitialized()
    {
        MakeElectronic();
    }
    public void MakeElectronic()
    {
        for (int i = 0; i < 5; i++)
        {
            electronics.Add(Creator.Create("CPU"));
            electronics.Add(Creator.Create("Motherboard"));
            electronics.Add(Creator.Create("HDD"));

        }
    }
    private async Task<IEnumerable<ElectronicBase>> Search(string value)
    {
        if (string.IsNullOrEmpty(value))
            return electronics.ToList();
        return electronics.Where(x => x.Number.Contains(value, StringComparison.InvariantCultureIgnoreCase)).ToList();
    }

    private void MakeOrder()
    {
        if (!string.IsNullOrEmpty(Role))
        {
            if (Role.ToLower() == "кладовщик")
            {
                IElectronicOpt electronicOpt = new ElectronicOpt();
                newElectronic = electronicOpt.OrderGood();
                if (newElectronic != null)
                {
                    electronics.Add(newElectronic);
                    _snackbar.Add("Заказ создан");

                };
            }
            else _snackbar.Add("У вашей роли не достаточно прав");
        }
        else
        {
            _snackbar.Add("Выберите роль!");
        }

    }
}